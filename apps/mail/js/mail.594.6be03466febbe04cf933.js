/*! For license information please see mail.594.6be03466febbe04cf933.js.LICENSE.txt */
(self.webpackChunknextcloud_mail=self.webpackChunknextcloud_mail||[]).push([[594],{72749:(t,e,n)=>{var i={"./af":50554,"./af.js":50554,"./ar":51634,"./ar.js":51634,"./ast":29303,"./ast.js":29303,"./az":97078,"./az.js":97078,"./bg":80996,"./bg.js":80996,"./bn":48213,"./bn.js":48213,"./bs":3210,"./bs.js":3210,"./ca":89306,"./ca.js":89306,"./cs":35017,"./cs.js":35017,"./da":54505,"./da.js":54505,"./de":88780,"./de-ch":32847,"./de-ch.js":32847,"./de.js":88780,"./el":45374,"./el.js":45374,"./en-au":51920,"./en-au.js":51920,"./en-gb":98203,"./en-gb.js":98203,"./eo":49486,"./eo.js":49486,"./es":81565,"./es-co":5604,"./es-co.js":5604,"./es.js":81565,"./et":64458,"./et.js":64458,"./eu":48629,"./eu.js":48629,"./fa":96594,"./fa.js":96594,"./fi":17123,"./fi.js":17123,"./fr":34351,"./fr.js":34351,"./gl":57774,"./gl.js":57774,"./gu":4378,"./gu.js":4378,"./he":66007,"./he.js":66007,"./hi":21961,"./hi.js":21961,"./hr":54466,"./hr.js":54466,"./hu":49510,"./hu.js":49510,"./id":38623,"./id.js":38623,"./it":70848,"./it.js":70848,"./ja":2489,"./ja.js":2489,"./jv":4231,"./jv.js":4231,"./km":37113,"./km.js":37113,"./kn":12405,"./kn.js":12405,"./ko":66766,"./ko.js":66766,"./ku":95257,"./ku.js":95257,"./lt":49748,"./lt.js":49748,"./lv":24976,"./lv.js":24976,"./ms":5043,"./ms.js":5043,"./nb":240,"./nb.js":240,"./ne":63923,"./ne.js":63923,"./nl":71195,"./nl.js":71195,"./no":14962,"./no.js":14962,"./oc":26770,"./oc.js":26770,"./pl":10605,"./pl.js":10605,"./pt":18591,"./pt-br":88827,"./pt-br.js":88827,"./pt.js":18591,"./ro":24485,"./ro.js":24485,"./ru":94507,"./ru.js":94507,"./si":98608,"./si.js":98608,"./sk":61075,"./sk.js":61075,"./sl":44240,"./sl.js":44240,"./sq":5097,"./sq.js":5097,"./sr":50849,"./sr-latn":83813,"./sr-latn.js":83813,"./sr.js":50849,"./sv":48888,"./sv.js":48888,"./th":41089,"./th.js":41089,"./tk":10729,"./tk.js":10729,"./tr":15654,"./tr.js":15654,"./tt":5550,"./tt.js":5550,"./ug":34046,"./ug.js":34046,"./uk":46390,"./uk.js":46390,"./ur":28339,"./ur.js":28339,"./uz":2316,"./uz.js":2316,"./vi":23865,"./vi.js":23865,"./zh":4516,"./zh-cn":60758,"./zh-cn.js":60758,"./zh.js":4516};function o(t){return r(t).then((t=>n.t(t,23)))}function r(t){return n.e(390).then((()=>{if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}))}o.keys=()=>Object.keys(i),o.resolve=r,o.id=72749,t.exports=o},11130:(t,e,n)=>{"use strict";n.d(e,{LQ:()=>r,ZP:()=>s,tj:()=>o});var i=n(9780);const o="change_alias",r="editor_ready";class s extends i.Z{removeSignatureElement(t,e){const n=t.model.createRangeIn(t.model.document.getRoot());for(const t of n.getWalker({shallow:!0}))t.item.is("element")&&"signature"===t.item.name&&e.remove(t.item)}insertSignatureElement(t,e,n,i){if(0===n.length)return;const o=t.data.processor.toView(n),r=t.data.toModel(o),s=e.createElement("signature");e.append(e.createText("-- "),s),e.append(e.createElement("paragraph"),s),e.append(r,s),i&&e.append(e.createElement("paragraph"),s);const a=this.findPosition(t,e,i);t.model.insertContent(s,a)}findPosition(t,e,n){if(n){const n=t.model.createRangeIn(t.model.document.getRoot());for(const t of n.getWalker({shallow:!0}))if(t.item.is("element")&&"quote"===t.item.name)return e.createPositionBefore(t.item)}return e.createPositionAt(t.model.document.getRoot(),"end")}hasSignatureElement(t){const e=t.model.createRangeIn(t.model.document.getRoot());for(const t of e.getWalker({shallow:!0}))if(t.item.is("element")){if("quote"===t.item.name)continue;if("signature"===t.item.name)return!0}return!1}execute(t,e,n){this.editor.model.change((i=>{t===o&&(this.removeSignatureElement(this.editor,i),this.insertSignatureElement(this.editor,i,e,n)),t!==r||this.hasSignatureElement(this.editor)||this.insertSignatureElement(this.editor,i,e,n)}))}refresh(){this.isEnabled=!0}}},88765:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(87537),o=n.n(i),r=n(23645),s=n.n(r)()(o());s.push([t.id,"[data-v-2d80d17f] a{color:#07d}[data-v-2d80d17f] p{cursor:text;margin:0 !important}","",{version:3,sources:["webpack://./src/components/TextEditor.vue"],names:[],mappings:"AACA,oBACC,UAAA,CAED,oBACC,WAAA,CACA,mBAAA",sourcesContent:["\n:deep(a) {\n\tcolor: #07d;\n}\n:deep(p) {\n\tcursor: text;\n\tmargin: 0 !important;\n}\n"],sourceRoot:""}]);const a=s},50799:(t,e,n)=>{"use strict";n.d(e,{Z:()=>a});var i=n(87537),o=n.n(i),r=n(23645),s=n.n(r)()(o());s.push([t.id,"\n/*\nOverwrite the default z-index for CKEditor\nhttps://github.com/ckeditor/ckeditor5/issues/1142\n */\n.ck .ck-reset {\n\tbackground: var(--color-main-background) !important;\n}\n.custom-item-username {\n\tcolor: var(--color-main-text) !important;\n}\n.link-title{\n\tcolor: var(--color-main-text) !important;\n}\n.link-icon{\n\twidth : 20px !important;\n\tmargin-right : 1em !important;\n\tfilter : var(--background-invert-if-dark);\n}\n.custom-item {\n\twidth : 100% !important;\n\tborder-radius : 8px !important;\n\tpadding : 4px 8px !important;\n\tdisplay :block;\n\tbackground:var(--color-main-background)!important;\n}\n.custom-item:hover {\n\tbackground:var(--color-primary-element-light)!important;\n}\n.link-container{\n\tborder-radius :8px !important;\n\tpadding :4px 8px !important;\n\tdisplay : block;\n\twidth : 100% !important;\n\tbackground:var(--color-main-background)!important;\n}\n.link-container:hover {\n\tbackground:var(--color-primary-element-light)!important;\n}\n:root {\n\t--ck-z-default: 10000;\n\t--ck-balloon-border-width:  0;\n}\n","",{version:3,sources:["webpack://./src/components/TextEditor.vue"],names:[],mappings:";AAgUA;;;EAGA;AACA;CACA,mDAAA;AACA;AACA;CACA,wCAAA;AACA;AACA;CACA,wCAAA;AACA;AACA;CACA,uBAAA;CACA,6BAAA;CACA,yCAAA;AACA;AACA;CACA,uBAAA;CACA,8BAAA;CACA,4BAAA;CACA,cAAA;CACA,iDAAA;AACA;AACA;CACA,uDAAA;AACA;AACA;CACA,6BAAA;CACA,2BAAA;CACA,eAAA;CACA,uBAAA;CACA,iDAAA;AACA;AACA;CACA,uDAAA;AACA;AACA;CACA,qBAAA;CACA,6BAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @author 2019 Christoph Wurst <christoph@winzerhof-wurst.at>\n  - @author 2022 Richard Steinmetz <richard@steinmetz.cloud>\n  -\n  - @license AGPL-3.0-or-later\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<ckeditor\n\t\tv-if=\"ready\"\n\t\t:value=\"value\"\n\t\t:config=\"config\"\n\t\t:editor=\"editor\"\n\t\t:disabled=\"disabled\"\n\t\t@input=\"onEditorInput\"\n\t\t@ready=\"onEditorReady\" />\n</template>\n\n<script>\nimport CKEditor from '@ckeditor/ckeditor5-vue2'\nimport AlignmentPlugin from '@ckeditor/ckeditor5-alignment/src/alignment'\nimport { Mention } from '@ckeditor/ckeditor5-mention'\nimport Editor from '@ckeditor/ckeditor5-editor-balloon/src/ballooneditor'\nimport EssentialsPlugin from '@ckeditor/ckeditor5-essentials/src/essentials'\nimport BlockQuotePlugin from '@ckeditor/ckeditor5-block-quote/src/blockquote'\nimport BoldPlugin from '@ckeditor/ckeditor5-basic-styles/src/bold'\nimport FontPlugin from '@ckeditor/ckeditor5-font/src/font'\nimport ParagraphPlugin from '@ckeditor/ckeditor5-paragraph/src/paragraph'\nimport HeadingPlugin from '@ckeditor/ckeditor5-heading/src/heading'\nimport ItalicPlugin from '@ckeditor/ckeditor5-basic-styles/src/italic'\nimport LinkPlugin from '@ckeditor/ckeditor5-link/src/link'\nimport ListStyle from '@ckeditor/ckeditor5-list/src/liststyle'\nimport RemoveFormat from '@ckeditor/ckeditor5-remove-format/src/removeformat'\nimport SignaturePlugin from '../ckeditor/signature/SignaturePlugin.js'\nimport StrikethroughPlugin from '@ckeditor/ckeditor5-basic-styles/src/strikethrough'\nimport QuotePlugin from '../ckeditor/quote/QuotePlugin.js'\nimport Base64UploadAdapter from '@ckeditor/ckeditor5-upload/src/adapters/base64uploadadapter'\nimport ImagePlugin from '@ckeditor/ckeditor5-image/src/image'\nimport ImageResizePlugin from '@ckeditor/ckeditor5-image/src/imageresize'\nimport ImageUploadPlugin from '@ckeditor/ckeditor5-image/src/imageupload'\nimport MailPlugin from '../ckeditor/mail/MailPlugin.js'\nimport { searchProvider, getLinkWithPicker } from '@nextcloud/vue/dist/Components/NcRichText'\nimport { emojiSearch, emojiAddRecent } from '@nextcloud/vue/dist/Functions/emoji'\nimport { getLanguage } from '@nextcloud/l10n'\nimport logger from '../logger.js'\nimport PickerPlugin from '../ckeditor/smartpicker/PickerPlugin.js'\n\nexport default {\n\tname: 'TextEditor',\n\tcomponents: {\n\t\tckeditor: CKEditor.component,\n\t},\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\thtml: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tplaceholder: {\n\t\t\ttype: String,\n\t\t\tdefault: '',\n\t\t},\n\t\tfocus: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t\tbus: {\n\t\t\ttype: Object,\n\t\t\trequired: true,\n\t\t},\n\t\tdisabled: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\tconst plugins = [\n\t\t\tEssentialsPlugin,\n\t\t\tParagraphPlugin,\n\t\t\tSignaturePlugin,\n\t\t\tQuotePlugin,\n\t\t\tPickerPlugin,\n\t\t\tMention,\n\t\t]\n\t\tconst toolbar = ['undo', 'redo']\n\n\t\tif (this.html) {\n\t\t\tplugins.push(...[\n\t\t\t\tHeadingPlugin,\n\t\t\t\tAlignmentPlugin,\n\t\t\t\tBoldPlugin,\n\t\t\t\tItalicPlugin,\n\t\t\t\tBlockQuotePlugin,\n\t\t\t\tLinkPlugin,\n\t\t\t\tListStyle,\n\t\t\t\tFontPlugin,\n\t\t\t\tRemoveFormat,\n\t\t\t\tStrikethroughPlugin,\n\t\t\t\tImagePlugin,\n\t\t\t\tImageUploadPlugin,\n\t\t\t\tBase64UploadAdapter,\n\t\t\t\tImageResizePlugin,\n\t\t\t\tMailPlugin,\n\t\t\t])\n\t\t\ttoolbar.unshift(...[\n\t\t\t\t'heading',\n\t\t\t\t'fontFamily',\n\t\t\t\t'fontSize',\n\t\t\t\t'bold',\n\t\t\t\t'italic',\n\t\t\t\t'fontColor',\n\t\t\t\t'imageUpload',\n\t\t\t\t'alignment',\n\t\t\t\t'bulletedList',\n\t\t\t\t'numberedList',\n\t\t\t\t'blockquote',\n\t\t\t\t'fontBackgroundColor',\n\t\t\t\t'strikethrough',\n\t\t\t\t'link',\n\t\t\t\t'removeFormat',\n\t\t\t])\n\t\t}\n\n\t\treturn {\n\t\t\tlinkTribute: null,\n\t\t\temojiTribute: null,\n\t\t\ttextSmiles: [],\n\t\t\tready: false,\n\t\t\teditor: Editor,\n\t\t\tconfig: {\n\t\t\t\tplaceholder: this.placeholder,\n\t\t\t\tplugins,\n\t\t\t\ttoolbar: {\n\t\t\t\t\titems: toolbar,\n\t\t\t\t},\n\t\t\t\tlanguage: 'en',\n\t\t\t\tmention: {\n\t\t\t\t\tfeeds: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmarker: ':',\n\t\t\t\t\t\t\tfeed: this.getEmoji,\n\t\t\t\t\t\t\titemRenderer: this.customEmojiRenderer,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmarker: '/',\n\t\t\t\t\t\t\tfeed: this.getLink,\n\t\t\t\t\t\t\titemRenderer: this.customLinkRenderer,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t},\n\t\t}\n\t},\n\tbeforeMount() {\n\t\tthis.loadEditorTranslations(getLanguage())\n\t},\n\tmethods: {\n\t\tgetLink(text) {\n\t\t\tconst results = searchProvider(text)\n\t\t\tif (results.length === 1 && !results[0].title.toLowerCase().includes(text.toLowerCase())) {\n\t\t\t\treturn []\n\t\t\t}\n\t\t\treturn results\n\t\t},\n\t\tgetEmoji(text) {\n\t\t\tconst emojiResults = emojiSearch(text)\n\t\t\tif (this.textSmiles.includes(':' + text)) {\n\n\t\t\t\temojiResults.unshift(':' + text)\n\t\t\t}\n\t\t\treturn emojiResults\n\t\t},\n\t\t customEmojiRenderer(item) {\n\t\t\tconst itemElement = document.createElement('span')\n\n\t\t\titemElement.classList.add('custom-item')\n\t\t\titemElement.id = `mention-list-item-id-${item.colons}`\n\t\t\titemElement.textContent = `${item.native} `\n\t\t\tconst usernameElement = document.createElement('span')\n\n\t\t\tusernameElement.classList.add('custom-item-username')\n\t\t\tusernameElement.textContent = item.colons\n\n\t\t\titemElement.appendChild(usernameElement)\n\n\t\t\treturn itemElement\n\t\t},\n\t\tcustomLinkRenderer(item) {\n\t\t\tconst itemElement = document.createElement('span')\n\t\t\titemElement.classList.add('link-container')\n\n\t\t\tconst icon = document.createElement('img')\n\t\t\ticon.classList.add('link-icon')\n\t\t\ticon.src = `${item.icon_url} `\n\n\t\t\tconst usernameElement = document.createElement('span')\n\n\t\t\tusernameElement.classList.add('link-title')\n\t\t\tusernameElement.textContent = `${item.title} `\n\t\t\titemElement.appendChild(icon)\n\t\t\titemElement.appendChild(usernameElement)\n\n\t\t\treturn itemElement\n\t\t},\n\t\tasync loadEditorTranslations(language) {\n\t\t\tif (language === 'en') {\n\t\t\t\t// The default, nothing to fetch\n\t\t\t\treturn this.showEditor('en')\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tlogger.debug(`loading ${language} translations for CKEditor`)\n\t\t\t\tawait import(\n\t\t\t\t\t/* webpackMode: \"lazy-once\" */\n\t\t\t\t\t/* webpackPrefetch: true */\n\t\t\t\t\t/* webpackPreload: true */\n\t\t\t\t\t`@ckeditor/ckeditor5-build-balloon/build/translations/${language}`\n\t\t\t\t)\n\t\t\t\tthis.showEditor(language)\n\t\t\t} catch (error) {\n\t\t\t\tlogger.error(`could not find CKEditor translations for \"${language}\"`, { error })\n\t\t\t\tthis.showEditor('en')\n\t\t\t}\n\t\t},\n\t\tshowEditor(language) {\n\t\t\tlogger.debug(`using \"${language}\" as CKEditor language`)\n\t\t\tthis.config.language = language\n\n\t\t\tthis.ready = true\n\t\t},\n\t\t/**\n\t\t * @param {module:core/editor/editor~Editor} editor editor the editor instance\n\t\t */\n\t\tonEditorReady(editor) {\n\t\t\tlogger.debug('TextEditor is ready', { editor })\n\n\t\t\teditor.commands.get('mention')?.on('execute', (event, data) => {\n\t\t\t\tevent.stop()\n\t\t\t\tconst eventData = data[0]\n\t\t\t\tconst item = eventData.mention\n\t\t\t\tif (eventData.marker === ':') {\n\t\t\t\t\temojiAddRecent(item)\n\t\t\t\t\tthis.editorInstance.execute('insertItem', item.native, ':')\n\t\t\t\t}\n\t\t\t\tif (eventData.marker === '/') {\n\t\t\t\t\tgetLinkWithPicker(item.id)\n\t\t\t\t\t\t.then((link) => {\n\t\t\t\t\t\t\tthis.editorInstance.execute('insertItem', link, '/')\n\t\t\t\t\t\t\tthis.editorInstance.editing.view.focus()\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tconsole.debug('Smart picker promise rejected:', error)\n\t\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}, { priority: 'high' })\n\t\t\tthis.editorInstance = editor\n\n\t\t\tif (this.focus) {\n\t\t\t\tlogger.debug('focusing TextEditor')\n\t\t\t\teditor.editing.view.focus()\n\t\t\t}\n\n\t\t\tif (this.html) {\n\t\t\t\tthis.$emit('show-toolbar', editor.ui._focusableToolbarDefinitions[0].toolbarView.element)\n\t\t\t}\n\t\t\tthis.bus.$on('append-to-body-at-cursor', this.appendToBodyAtCursor)\n\t\t\tthis.$emit('ready', editor)\n\t\t},\n\t\tonEditorInput(text) {\n\t\t\tif (text !== this.value) {\n\t\t\t\tlogger.debug(`TextEditor input changed to <${text}>`)\n\t\t\t\tthis.$emit('input', text)\n\t\t\t}\n\t\t},\n\t\tappendToBodyAtCursor(toAppend) {\n\t\t\t// https://ckeditor.com/docs/ckeditor5/latest/builds/guides/faq.html#where-are-the-editorinserthtml-and-editorinserttext-methods-how-to-insert-some-content\n\t\t\tconst viewFragment = this.editorInstance.data.processor.toView(toAppend)\n\t\t\tconst modelFragment = this.editorInstance.data.toModel(viewFragment)\n\t\t\tthis.editorInstance.model.insertContent(modelFragment)\n\t\t},\n\t\teditorExecute(commandName, ...args) {\n\t\t\tif (this.editorInstance) {\n\t\t\t\tthis.editorInstance.execute(commandName, ...args)\n\t\t\t} else {\n\t\t\t\tthrow new Error('Impossible to execute a command before editor is ready.')\n\t\t\t}\n\t\t},\n\t},\n}\n<\/script>\n\n<style lang=\"scss\" scoped>\n:deep(a) {\n\tcolor: #07d;\n}\n:deep(p) {\n\tcursor: text;\n\tmargin: 0 !important;\n}\n</style>\n\n<style>\n/*\nOverwrite the default z-index for CKEditor\nhttps://github.com/ckeditor/ckeditor5/issues/1142\n */\n .ck .ck-reset {\n\tbackground: var(--color-main-background) !important;\n }\n .custom-item-username {\n\tcolor: var(--color-main-text) !important;\n }\n .link-title{\n\tcolor: var(--color-main-text) !important;\n }\n .link-icon{\n\twidth : 20px !important;\n\tmargin-right : 1em !important;\n\tfilter : var(--background-invert-if-dark);\n }\n .custom-item {\n\twidth : 100% !important;\n\tborder-radius : 8px !important;\n\tpadding : 4px 8px !important;\n\tdisplay :block;\n\tbackground:var(--color-main-background)!important;\n }\n .custom-item:hover {\n\tbackground:var(--color-primary-element-light)!important;\n }\n .link-container{\n\tborder-radius :8px !important;\n\tpadding :4px 8px !important;\n\tdisplay : block;\n\twidth : 100% !important;\n\tbackground:var(--color-main-background)!important;\n }\n .link-container:hover {\n\tbackground:var(--color-primary-element-light)!important;\n }\n:root {\n\t--ck-z-default: 10000;\n\t--ck-balloon-border-width:  0;\n\t}\n</style>\n"],sourceRoot:""}]);const a=s},55594:(t,e,n)=>{"use strict";n.d(e,{Z:()=>X});var i=n(70669),o=n.n(i),r=n(68297),s=n(93189),a=n(65035),d=n(3418),l=n(72425),c=n(11188),m=n(70941),u=n(60412),g=n(3211),h=n(33324),p=n(23022),A=n(36463),f=n(18461),k=n(59641),b=n(11130);class C extends k.Z{init(){this._defineSchema(),this._defineConverters(),this.editor.commands.add("insertSignature",new b.ZP(this.editor))}_defineSchema(){this.editor.model.schema.register("signature",{inheritAllFrom:"$container"})}_defineConverters(){this.editor.conversion.elementToElement({model:"signature",view:{name:"div",classes:"signature"}})}}var v=n(87332);class E extends k.Z{init(){this._defineSchema(),this._defineConverters()}_defineSchema(){this.editor.model.schema.register("quote",{inheritAllFrom:"$container"})}_defineConverters(){this.editor.conversion.elementToElement({model:"quote",view:{name:"div",classes:"quote"}})}}var j=n(21876),x=n(7178),y=n(12534),w=n(20971),P=n(57963);class I extends k.Z{static get requires(){return[P.n]}init(){this._overwriteParagraphConversion()}_overwriteParagraphConversion(){this.editor.conversion.elementToElement({model:"paragraph",view:{name:"p",styles:{margin:0}},converterPriority:"high"})}}var T=n(86680),L=n(49043),R=n(31352),S=n(89177),Z=n(9780);class B extends Z.Z{insertItem(t,e,n,i){const o=t.model.document.selection.getLastPosition();if(null===o)return;const r=t.model.createRange(o.getShiftedBy(-5),o).getWalker({shallow:!1,direction:"backward"});for(const o of r)if("text"===o.type&&o.item.data.includes(i)){e.remove(o.item);const r=o.item.data,s=r.lastIndexOf(i),a=e.createElement("paragraph");e.insertText(r.substring(0,s),a),t.model.insertContent(a);const d=e.createElement("paragraph");return e.insertText(n,d),void t.model.insertContent(d)}}execute(t,e){this.editor.model.change((n=>{this.insertItem(this.editor,n,t,e)}))}refresh(){this.isEnabled=!0}}class _ extends k.Z{init(){this.editor.commands.add("insertItem",new B(this.editor))}}const z={name:"TextEditor",components:{ckeditor:o().component},props:{value:{type:String,required:!0},html:{type:Boolean,default:!1},placeholder:{type:String,default:""},focus:{type:Boolean,default:!1},bus:{type:Object,required:!0},disabled:{type:Boolean,default:!1}},data(){const t=[d.Z,u.Z,C,E,_,s.pf],e=["undo","redo"];return this.html&&(t.push(g.Z,r.Z,c.Z,h.Z,l.Z,p.Z,A.Z,m.Z,f.Z,v.Z,x.Z,w.Z,j.Z,y.Z,I),e.unshift("heading","fontFamily","fontSize","bold","italic","fontColor","imageUpload","alignment","bulletedList","numberedList","blockquote","fontBackgroundColor","strikethrough","link","removeFormat")),{linkTribute:null,emojiTribute:null,textSmiles:[],ready:!1,editor:a.Z,config:{placeholder:this.placeholder,plugins:t,toolbar:{items:e},language:"en",mention:{feeds:[{marker:":",feed:this.getEmoji,itemRenderer:this.customEmojiRenderer},{marker:"/",feed:this.getLink,itemRenderer:this.customLinkRenderer}]}}}},beforeMount(){this.loadEditorTranslations((0,R.G3)())},methods:{getLink(t){const e=(0,T.searchProvider)(t);return 1!==e.length||e[0].title.toLowerCase().includes(t.toLowerCase())?e:[]},getEmoji(t){const e=(0,L.emojiSearch)(t);return this.textSmiles.includes(":"+t)&&e.unshift(":"+t),e},customEmojiRenderer(t){const e=document.createElement("span");e.classList.add("custom-item"),e.id="mention-list-item-id-".concat(t.colons),e.textContent="".concat(t.native," ");const n=document.createElement("span");return n.classList.add("custom-item-username"),n.textContent=t.colons,e.appendChild(n),e},customLinkRenderer(t){const e=document.createElement("span");e.classList.add("link-container");const n=document.createElement("img");n.classList.add("link-icon"),n.src="".concat(t.icon_url," ");const i=document.createElement("span");return i.classList.add("link-title"),i.textContent="".concat(t.title," "),e.appendChild(n),e.appendChild(i),e},async loadEditorTranslations(t){if("en"===t)return this.showEditor("en");try{S.Z.debug("loading ".concat(t," translations for CKEditor")),await n(72749)("./".concat(t)),this.showEditor(t)}catch(e){S.Z.error('could not find CKEditor translations for "'.concat(t,'"'),{error:e}),this.showEditor("en")}},showEditor(t){S.Z.debug('using "'.concat(t,'" as CKEditor language')),this.config.language=t,this.ready=!0},onEditorReady(t){var e;S.Z.debug("TextEditor is ready",{editor:t}),null===(e=t.commands.get("mention"))||void 0===e||e.on("execute",((t,e)=>{t.stop();const n=e[0],i=n.mention;":"===n.marker&&((0,L.emojiAddRecent)(i),this.editorInstance.execute("insertItem",i.native,":")),"/"===n.marker&&(0,T.getLinkWithPicker)(i.id).then((t=>{this.editorInstance.execute("insertItem",t,"/"),this.editorInstance.editing.view.focus()})).catch((t=>{console.debug("Smart picker promise rejected:",t)}))}),{priority:"high"}),this.editorInstance=t,this.focus&&(S.Z.debug("focusing TextEditor"),t.editing.view.focus()),this.html&&this.$emit("show-toolbar",t.ui._focusableToolbarDefinitions[0].toolbarView.element),this.bus.$on("append-to-body-at-cursor",this.appendToBodyAtCursor),this.$emit("ready",t)},onEditorInput(t){t!==this.value&&(S.Z.debug("TextEditor input changed to <".concat(t,">")),this.$emit("input",t))},appendToBodyAtCursor(t){const e=this.editorInstance.data.processor.toView(t),n=this.editorInstance.data.toModel(e);this.editorInstance.model.insertContent(n)},editorExecute(t){if(!this.editorInstance)throw new Error("Impossible to execute a command before editor is ready.");for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.editorInstance.execute(t,...n)}}};var F=n(93379),q=n.n(F),$=n(7795),U=n.n($),D=n(90569),M=n.n(D),N=n(3565),O=n.n(N),W=n(19216),K=n.n(W),G=n(44589),Q=n.n(G),V=n(88765),H={};H.styleTagTransform=Q(),H.setAttributes=O(),H.insert=M().bind(null,"head"),H.domAPI=U(),H.insertStyleElement=K(),q()(V.Z,H),V.Z&&V.Z.locals&&V.Z.locals;var Y=n(50799),J={};J.styleTagTransform=Q(),J.setAttributes=O(),J.insert=M().bind(null,"head"),J.domAPI=U(),J.insertStyleElement=K(),q()(Y.Z,J),Y.Z&&Y.Z.locals&&Y.Z.locals;const X=(0,n(51900).Z)(z,(function(){var t=this,e=t._self._c;return t.ready?e("ckeditor",{attrs:{value:t.value,config:t.config,editor:t.editor,disabled:t.disabled},on:{input:t.onEditorInput,ready:t.onEditorReady}}):t._e()}),[],!1,null,"2d80d17f",null).exports}}]);
//# sourceMappingURL=mail.594.6be03466febbe04cf933.js.map